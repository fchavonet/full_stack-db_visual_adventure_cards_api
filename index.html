<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Dragon Ball Visual Adventure Cards API</title>
    <meta name="description" content="An open-source API providing structured data on Dragon Ball Visual Adventure cards for community-driven tools and applications.">

    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body>
    <main>
        <section>
            <h1>Dragon Ball Visual Adventure Cards API</h1>

            <p>
                This service provides structured data on Dragon Ball Visual Adventure cards, produced by Bandai in the 1990s.
                <br>
                It enables developers to easily create tools and applications around this iconic series.
                <br>
                The API is open source and free to use, designed to support the community and simplify card management.
            </p>

            <h2>API Documentation</h2>

            <h3>API Endpoints</h3>

            <ul>
                <li>
                    <code>api/v1/meta.json</code>
                    <span>Returns API metadata including part information and statistics.</span>
                </li>

                <li>
                    <code>api/v1/cards.json</code>
                    <span>Returns an array of all cards with complete data.</span>
                </li>

                <li>
                    <code>api/v1/parts/{part_number}.json</code>
                    <span>Returns cards for a specified part (e.g. parts/1.json).</span>
                </li>

                <li>
                    <code>api/v1/cards/{card_id}.json</code>
                    <span>Returns a single card object (e.g. cards/p1-001.json).</span>
                </li>
            </ul>

            <h3>Card Object Properties</h3>

            <ul>
                <li><code>id</code> - Unique card identifier.</li>
                <li><code>part</code> - Part number.</li>
                <li><code>number</code> - Card number.</li>
                <li><code>year</code> - Release year.</li>
                <li><code>rarity</code> - Card rarity (prism, standard, special).</li>
                <li><code>title_jp</code> - Japanese title.</li>
                <li><code>title_en</code> - English title.</li>
                <li><code>title_fr</code> - French title.</li>
                <li><code>front_image_url</code> - Front image URL.</li>
                <li><code>back_image_url</code> - Back image URL.</li>
                <li><code>updated_at</code> - Last update timestamp.</li>
            </ul>

            <h2>Test the API</h2>

            <div>
                <label for="part-select">Select a part:</label>

                <select id="part-select" class="border" disabled>
                    <option value="">Choose a part</option>
                </select>
            </div>

            <div>
                <label for="card-select">Select a card:</label>

                <select id="card-select" class="border" disabled>
                    <option value="">First, choose a part</option>
                </select>
            </div>
        </section>

        <section>
            <div>
                <h2>Card Details</h2>

                <div id="card-details">
                    <p>No part selected.</p>
                </div>
            </div>
        </section>
    </main>

    <script>
        let allCardData = [];

        const partSelect = document.getElementById("part-select");
        const cardSelect = document.getElementById("card-select");
        const cardDetails = document.getElementById("card-details");

        // Load available parts from API metadata.
        async function loadParts() {
            try {
                const response = await fetch("./api/v1/meta.json");
                const metadata = await response.json();

                for (const partNumber in metadata.parts) {
                    const option = document.createElement("option");
                    option.value = partNumber;
                    option.textContent = "Part " + partNumber;
                    partSelect.appendChild(option);
                }

                partSelect.disabled = false;
            } catch (error) {
                console.error(error.message);
            }
        }

        // Load cards for selected part.
        async function loadCards(partNumber) {
            try {
                const response = await fetch("./api/v1/parts/" + partNumber + ".json");
                allCardData = await response.json();

                cardSelect.innerHTML = '<option value="">Choose a card</option>';

                for (const cardData of allCardData) {
                    const option = document.createElement("option");
                    option.value = cardData.id;
                    option.textContent = cardData.number + " - " + cardData.title_jp;
                    cardSelect.appendChild(option);
                }

                cardSelect.disabled = false;
            } catch (error) {
                console.error(error.message);
            }
        }

        // Fetch single card data by ID.
        async function loadSingleCard(cardId) {
            try {
                const response = await fetch("./api/v1/cards/" + cardId + ".json");

                return await response.json();
            } catch (error) {
                console.error(error.message);
            }
        }

        // Display selected card details.
        async function displayCardDetails(selectedCard) {
            const cardData = await loadSingleCard(selectedCard);

            cardDetails.innerHTML = "";

            const cardInfoList = document.createElement("ul");

            const cardInfo = [
                "Part: " + cardData.part,
                "Number: " + cardData.number,
                "Year: " + cardData.year,
                "Rarity: " + cardData.rarity,
                "Title (JP): " + cardData.title_jp,
                "Title (EN): " + cardData.title_en,
                "Title (FR): " + cardData.title_fr
            ];

            cardInfo.forEach(info => {
                const li = document.createElement("li");
                li.textContent = info;
                cardInfoList.appendChild(li);
            });

            cardDetails.appendChild(cardInfoList);

            const cardContainer = document.createElement("div");
            cardContainer.className = "w-64 h-96 cursor-pointer";
            cardContainer.style.perspective = "1000px";

            const cardFlipper = document.createElement("div");
            cardFlipper.className = "w-full h-full relative  transition-transform duration-700";
            cardFlipper.style.transformStyle = "preserve-3d";

            // Front side.
            const frontSide = document.createElement("div");
            frontSide.className = "w-full h-full absolute inset-0";
            frontSide.style.backfaceVisibility = "hidden";

            const frontImg = document.createElement("img");
            frontImg.className = "w-full h-full object-cover rounded-lg";
            frontImg.src = cardData.front_image_url;
            frontImg.alt = "Card front";
            frontSide.appendChild(frontImg);

            // Back side.
            const backSide = document.createElement("div");
            backSide.className = "w-full h-full absolute inset-0";
            backSide.style.backfaceVisibility = "hidden";
            backSide.style.transform = "rotateY(-180deg)";

            const backImg = document.createElement("img");
            backImg.className = "w-full h-full object-cover rounded-lg";
            backImg.src = cardData.back_image_url;
            backImg.alt = "Card back";
            backSide.appendChild(backImg);

            cardFlipper.appendChild(frontSide);
            cardFlipper.appendChild(backSide);
            cardContainer.appendChild(cardFlipper);

            let isFlipped = false;

            cardContainer.addEventListener("click", () => {
                if (isFlipped) {
                    cardFlipper.style.transform = "rotateY(0deg)";
                } else {
                    cardFlipper.style.transform = "rotateY(180deg)";
                }

                isFlipped = !isFlipped;
            });

            cardDetails.appendChild(cardContainer);
        }

        // Handle part selection changes.
        partSelect.addEventListener("change", () => {
            if (partSelect.value) {
                loadCards(partSelect.value);
                cardDetails.innerHTML = "<p>No card selected.</p>";
            } else {
                cardSelect.innerHTML = '<option value="">First, select a part</option>';
                cardSelect.disabled = true;
                cardDetails.innerHTML = "<p>No part selected.</p>";
            }
        });

        // Handle card selection changes.
        cardSelect.addEventListener("change", () => {
            if (cardSelect.value) {
                displayCardDetails(cardSelect.value);
            } else {
                cardDetails.innerHTML = "<p>No card selected.</p>";
            }
        });

        // Initialize the application.
        loadParts();
    </script>
</body>

</html>