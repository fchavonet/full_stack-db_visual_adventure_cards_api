<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Dragon Ball Visual Adventure Cards API</title>
    <meta name="description" content="An open-source API providing structured data on Dragon Ball Visual Adventure cards for community-driven tools and applications.">

    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body class="w-full h-full lg:h-screen p-2 flex justify-center items-center text-xs text-slate-900">
    <main class="flex flex-col lg:flex-row gap-2">
        <section class="flex flex-col gap-2 border">
            <h1 class="w-full px-2 py-2 text-lg lg:text-2xl font-bold text-center border-b">Dragon Ball Visual Adventure Cards API</h1>

            <p class="px-2">
                This service provides structured data on Dragon Ball Visual Adventure cards, produced by Bandai in the 1990s.
                <br>
                It enables developers to easily create tools and applications around this iconic series.
                <br>
                The API is open source and free to use, designed to support the community and simplify card management.
            </p>

            <h2 class="px-2 text-lg lg:text-xl font-bold">API Documentation</h2>

            <div class="px-2">
                <h3 class="mb-1 text-base font-bold">API Endpoints</h3>

                <ul class="flex flex-col gap-2">
                    <li>
                        <a class="flex flex-col cursor-pointer" href="./api/v1/meta.json" target="_blank" rel="noopener noreferrer">
                            <code class="px-2 py-1 border">api/v1/meta.json</code>
                            <span class="mt-1 px-2">Returns API metadata including part information and statistics.</span>
                        </a>
                    </li>

                    <li>
                        <a class="flex flex-col cursor-pointer" href="./api/v1/cards.json" target="_blank" rel="noopener noreferrer">
                            <code class="px-2 py-1 border">api/v1/cards.json</code>
                            <span class="mt-1 px-2">Returns an array of all cards with complete data.</span>
                        </a>
                    </li>

                    <li>
                        <a class="flex flex-col cursor-pointer" href="./api/v1/parts/1.json" target="_blank" rel="noopener noreferrer">
                            <code class="px-2 py-1 border">api/v1/parts/{part_number}.json</code>
                            <span class="mt-1 px-2">Returns cards for a specified part (e.g. parts/1.json).</span>
                        </a>
                    </li>

                    <li>
                        <a class="flex flex-col cursor-pointer" href="./api/v1/cards/p1-001.json" target="_blank" rel="noopener noreferrer">
                            <code class="px-2 py-1 border">api/v1/cards/{card_id}.json</code>
                            <span class="mt-1 px-2">Returns a single card object (e.g. cards/p1-001.json).</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="px-2">
                <h3 class="mb-1 text-base font-bold">Card Object Properties</h3>

                <ul class="px-2 py-1  flex flex-col border">
                    <li><code>id</code> - Unique card identifier.</li>
                    <li><code>part</code> - Part number.</li>
                    <li><code>number</code> - Card number.</li>
                    <li><code>year</code> - Release year.</li>
                    <li><code>rarity</code> - Card rarity (prism, standard, special).</li>
                    <li><code>title_jp</code> - Japanese title.</li>
                    <li><code>title_en</code> - English title.</li>
                    <li><code>title_fr</code> - French title.</li>
                    <li><code>front_image_url</code> - Front image URL.</li>
                    <li><code>back_image_url</code> - Back image URL.</li>
                    <li><code>updated_at</code> - Last update timestamp.</li>
                </ul>
            </div>

            <p class="mt-auto px-2 py-2">
                Dragon Ball and related characters are trademarks of Akira Toriyama, Bandai and Toei Animation.
                <br>
                This API is for educational and non-commercial purposes only.
            </p>
        </section>

        <section class="w-full lg:w-80 flex flex-col gap-2 border">
            <div class="flex flex-col gap-2">
                <h2 class="w-full px-2 py-2 text-lg lg:text-2xl font-bold text-center border-b">Test the API</h2>

                <div class="px-2 flex flex-col">
                    <label for="part-select">Select a part:</label>

                    <select id="part-select" class="border disabled:text-slate-300 cursor-pointer disabled:cursor-not-allowed" disabled>
                        <option value="">Choose a part</option>
                    </select>
                </div>

                <div class="px-2 flex flex-col">
                    <label for="card-select">Select a card:</label>

                    <select id="card-select" class="border disabled:text-slate-300 cursor-pointer disabled:cursor-not-allowed" disabled>
                        <option value="">First, choose a part</option>
                    </select>
                </div>
            </div>

            <div class="flex flex-col">
                <h2 class="px-2 text-lg lg:text-xl font-bold">Card Details</h2>

                <div id="card-details" class="lg:min-h-[515px] px-2 pb-2 flex flex-col gap-2">
                    <p>No part selected.</p>
                </div>
            </div>
        </section>
    </main>

    <script>
        let allCardData = [];

        const partSelect = document.getElementById("part-select");
        const cardSelect = document.getElementById("card-select");
        const cardDetails = document.getElementById("card-details");

        // Load available parts from API metadata.
        async function loadParts() {
            try {
                const response = await fetch("./api/v1/meta.json");
                const metadata = await response.json();

                for (const partNumber in metadata.parts) {
                    const option = document.createElement("option");
                    option.value = partNumber;
                    option.textContent = "Part " + partNumber;
                    partSelect.appendChild(option);
                }

                partSelect.disabled = false;
            } catch (error) {
                console.error(error.message);
            }
        }

        // Load cards for selected part.
        async function loadCards(partNumber) {
            try {
                const response = await fetch("./api/v1/parts/" + partNumber + ".json");
                allCardData = await response.json();

                cardSelect.innerHTML = '<option value="">Choose a card</option>';

                for (const cardData of allCardData) {
                    const option = document.createElement("option");
                    option.value = cardData.id;
                    option.textContent = cardData.number + " - " + cardData.title_jp;
                    cardSelect.appendChild(option);
                }

                cardSelect.disabled = false;
            } catch (error) {
                console.error(error.message);
            }
        }

        // Fetch single card data by ID.
        async function loadSingleCard(cardId) {
            try {
                const response = await fetch("./api/v1/cards/" + cardId + ".json");

                return await response.json();
            } catch (error) {
                console.error(error.message);
            }
        }

        // Display selected card details.
        async function displayCardDetails(selectedCard) {
            const cardData = await loadSingleCard(selectedCard);

            cardDetails.innerHTML = "";

            const cardInfoList = document.createElement("ul");

            const cardInfo = [
                "Part: " + cardData.part,
                "Number: " + cardData.number,
                "Year: " + cardData.year,
                "Rarity: " + cardData.rarity,
                "Title (JP): " + cardData.title_jp,
                "Title (EN): " + cardData.title_en,
                "Title (FR): " + cardData.title_fr
            ];

            cardInfo.forEach(info => {
                const li = document.createElement("li");
                li.textContent = info;
                cardInfoList.appendChild(li);
            });

            cardDetails.appendChild(cardInfoList);

            const cardContainer = document.createElement("div");
            cardContainer.className = "w-64 h-96 mx-auto cursor-pointer";
            cardContainer.style.perspective = "1000px";

            const cardFlipper = document.createElement("div");
            cardFlipper.className = "w-full h-full relative transition-transform duration-700";
            cardFlipper.style.transformOrigin = "center";
            cardFlipper.style.transformStyle = "preserve-3d";

            // Front side.
            const frontSide = document.createElement("div");
            frontSide.className = "w-full h-full absolute inset-0";
            frontSide.style.backfaceVisibility = "hidden";

            const frontImg = document.createElement("img");
            frontImg.className = "w-full h-full object-cover rounded-lg";
            frontImg.src = cardData.front_image_url;
            frontImg.alt = "Card front";
            frontSide.appendChild(frontImg);

            // Back side.
            const backSide = document.createElement("div");
            backSide.className = "w-full h-full absolute inset-0";
            backSide.style.backfaceVisibility = "hidden";
            backSide.style.transform = "rotateY(-180deg)";

            const backImg = document.createElement("img");
            backImg.className = "w-full h-full object-cover rounded-lg";
            backImg.src = cardData.back_image_url;
            backImg.alt = "Card back";
            backSide.appendChild(backImg);

            cardFlipper.appendChild(frontSide);
            cardFlipper.appendChild(backSide);
            cardContainer.appendChild(cardFlipper);

            let isFlipped = false;

            cardContainer.addEventListener("click", () => {
                if (isFlipped) {
                    cardFlipper.style.transform = "rotateY(0deg)";
                } else {
                    cardFlipper.style.transform = "rotateY(180deg)";
                }

                isFlipped = !isFlipped;
            });

            cardDetails.appendChild(cardContainer);
        }

        // Handle part selection changes.
        partSelect.addEventListener("change", () => {
            if (partSelect.value) {
                loadCards(partSelect.value);
                cardDetails.innerHTML = "<p>No card selected.</p>";
            } else {
                cardSelect.innerHTML = '<option value="">First, select a part</option>';
                cardSelect.disabled = true;
                cardDetails.innerHTML = "<p>No part selected.</p>";
            }
        });

        // Handle card selection changes.
        cardSelect.addEventListener("change", () => {
            if (cardSelect.value) {
                displayCardDetails(cardSelect.value);
            } else {
                cardDetails.innerHTML = "<p>No card selected.</p>";
            }
        });

        // Initialize the application.
        loadParts();
    </script>
</body>

</html>