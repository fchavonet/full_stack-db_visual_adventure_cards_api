<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Dragon Ball Visual Adventure Cards API</title>
    <meta name="description" content="An open-source API providing structured data on Dragon Ball Visual Adventure cards for community-driven tools and applications.">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body class="w-full h-full lg:h-screen p-2 flex flex-col justify-center items-center text-xs text-slate-900">
    <main class="flex flex-col lg:flex-row gap-4">
        <section class="flex flex-col gap-2 border border-slate-300 rounded-lg">
            <h1 class="w-full px-2 py-2 text-lg lg:text-2xl font-bold text-center border-b border-slate-300">Dragon Ball Visual Adventure Cards API</h1>

            <p class="px-2">
                This service provides structured data on <a class="text-sky-700" href="https://www.youtube.com/watch?v=vCU1JeaFlsA&list=PLmn6HKEaARYSZ4KyB0EPLudoUl5P3ojOd" target="_blank">Dragon Ball Visual Adventure cards</a>, produced by <a class="text-sky-700" href="https://fr.wikipedia.org/wiki/Bandai" target="_blank">Bandai</a> in the 1990s.
                <br>
                It enables developers to easily create tools and applications around this iconic series.
                <br>
                The API is open source and free to use, designed to support the community and simplify card management.
            </p>

            <h2 class="px-2 text-lg lg:text-xl font-bold">API Documentation</h2>

            <div class="px-2">
                <h3 class="mb-1 text-base font-bold">API Endpoints</h3>

                <ul class="flex flex-col gap-2">
                    <li>
                        <code class="px-2 py-1 relative flex flex-col font-mono text-sky-700 rounded bg-slate-100">
                            <a class="cursor-pointer" href="./api/v1/meta.json" target="_blank" rel="noopener noreferrer">
                                api/v1/meta.json
                            </a>

                            <i class="bi bi-copy absolute right-2 top-1/2 -translate-y-1/2 cursor-pointer hover:text-sky-900 transition-colors z-9999"
                               onclick="copyToClipboard('api/v1/meta.json', this)"
                               title="Copy to clipboard">
                            </i>
                        </code>

                        <p class="px-2">Returns API metadata.</p>
                    </li>

                    <li>
                        <code class="px-2 py-1 relative flex flex-col font-mono text-sky-700 rounded bg-slate-100">
                            <a class="cursor-pointer" href="./api/v1/cards.json" target="_blank" rel="noopener noreferrer">
                                api/v1/cards.json
                            </a>

                            <i class="bi bi-copy absolute right-2 top-1/2 -translate-y-1/2 cursor-pointer hover:text-sky-900 transition-colors z-9999"
                               onclick="copyToClipboard('api/v1/cards.json', this)"
                               title="Copy to clipboard">
                            </i>
                        </code>

                        <p class="px-2">Returns an array of all cards with complete data.</p>
                    </li>

                    <li>
                        <code class="px-2 py-1 relative flex flex-col font-mono text-sky-700 rounded bg-slate-100">
                            <a class="cursor-pointer" href="./api/v1/parts/1.json" target="_blank" rel="noopener noreferrer">
                                api/v1/parts/{part_number}.json
                            </a>

                            <i class="bi bi-copy absolute right-2 top-1/2 -translate-y-1/2 cursor-pointer hover:text-sky-900 transition-colors z-9999"
                               onclick="copyToClipboard('/api/v1/parts/1.json', this)"
                               title="Copy to clipboard">
                            </i>
                        </code>

                        <p class="px-2">Returns cards for a specified part (<span class="italic">e.g. parts/1.json</span>).</p>
                    </li>

                    <li>
                        <code class="px-2 py-1 relative flex flex-col font-mono text-sky-700 rounded bg-slate-100">
                            <a class="cursor-pointer" href="./api/v1/cards/p1-001.json" target="_blank" rel="noopener noreferrer">
                                api/v1/cards/{card_id}.json
                            </a>

                            <i class="bi bi-copy absolute right-2 top-1/2 -translate-y-1/2 cursor-pointer hover:text-sky-900 transition-colors z-9999"
                               onclick="copyToClipboard('/api/v1/cards/p1-001.json', this)"
                               title="Copy to clipboard">
                            </i>
                        </code>

                        <p class="px-2">Returns a single card object (<span class="italic">e.g. cards/p1-001.json</span>).</p>
                    </li>
                </ul>
            </div>

            <div class="px-2">
                <h3 class="mb-1 text-base font-bold">Card Object Properties</h3>

                <p class="mb-2 px-2">
                    Card objects represent individual trading cards with complete metadata for display, search, and collection management.
                </p>

                <ul class="px-2 py-1 flex flex-col font-mono rounded bg-slate-100">
                    <li><code class="text-sky-700">id</code> <i class="bi bi-arrow-right"></i> Unique card identifier.</li>
                    <li><code class="text-sky-700">part</code> <i class="bi bi-arrow-right"></i> Part number.</li>
                    <li><code class="text-sky-700">number</code> <i class="bi bi-arrow-right"></i> Card number.</li>
                    <li><code class="text-sky-700">year</code> <i class="bi bi-arrow-right"></i> Release year.</li>
                    <li><code class="text-sky-700">rarity</code> <i class="bi bi-arrow-right"></i> Card rarity (prism, standard, special).</li>
                    <li><code class="text-sky-700">title_jp</code> <i class="bi bi-arrow-right"></i> Japanese title.</li>
                    <li><code class="text-sky-700">title_en</code> <i class="bi bi-arrow-right"></i> English title.</li>
                    <li><code class="text-sky-700">title_fr</code> <i class="bi bi-arrow-right"></i> French title.</li>
                    <li><code class="text-sky-700">front_image_url</code> <i class="bi bi-arrow-right"></i> Front image URL.</li>
                    <li><code class="text-sky-700">back_image_url</code> <i class="bi bi-arrow-right"></i> Back image URL.</li>
                    <li><code class="text-sky-700">updated_at</code> <i class="bi bi-arrow-right"></i> Last update timestamp.</li>
                </ul>
            </div>

            <div class="mb-2 px-2">
                <h3 class="mb-1 text-base font-bold">API Status</h3>
                <p id="api-status" class="px-2 flex items-center font-mono gap-2"></p>
            </div>
        </section>

        <section class="w-full lg:w-80 flex flex-col gap-2 border border-slate-300 rounded-lg">
            <div class="flex flex-col gap-2">
                <h2 class="w-full px-2 py-2 text-lg lg:text-2xl font-bold text-center border-b border-slate-300">Test the API</h2>

                <div class="px-2 flex flex-col">
                    <label for="part-select">Select a part:</label>

                    <select id="part-select" class="p-1 font-mono rounded bg-slate-100 disabled:text-slate-300 cursor-pointer disabled:cursor-not-allowed" disabled>
                        <option value="">Choose a part</option>
                    </select>
                </div>

                <div class="px-2 flex flex-col">
                    <label for="card-select">Select a card:</label>

                    <select id="card-select" class="p-1 font-mono rounded bg-slate-100 disabled:bg-slate-100 disabled:text-slate-300 cursor-pointer disabled:cursor-not-allowed" disabled>
                        <option value="">First, choose a part</option>
                    </select>
                </div>
            </div>

            <div class="h-full flex flex-col">
                <h2 class="px-2 text-lg lg:text-xl font-bold">Card Details</h2>

                <div id="card-details" class="h-full mb-2 px-4 flex flex-col justify-between items-start gap-2">
                    <p>No part selected.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p class="mt-2 px-4 text-center">
            This API is for educational and non-commercial purposes only.
            Dragon Ball and related characters are trademarks of <a class="text-sky-700" href="https://fr.wikipedia.org/wiki/Akira_Toriyama" target="_blank">Akira Toriyama</a>, <a class="text-sky-700" href="https://fr.wikipedia.org/wiki/Bandai" target="_blank">Bandai</a> and <a class="text-sky-700" href="https://fr.wikipedia.org/wiki/Toei_Animation" target="_blank">Toei Animation</a>.
        </p>
    </footer>

    <script>
        let allCardData = [];

        const apiStatus = document.getElementById("api-status");
        const partSelect = document.getElementById("part-select");
        const cardSelect = document.getElementById("card-select");
        const cardDetails = document.getElementById("card-details");

        // Copy text to clipboard with visual feedback.
        async function copyToClipboard(text, iconElement) {
            try {
                await navigator.clipboard.writeText(text);

                const originalClass = iconElement.className;
                iconElement.className = iconElement.className.replace("bi-copy", "bi-check");
                iconElement.style.color = "#0369a1";

                setTimeout(() => {
                    iconElement.className = originalClass;
                    iconElement.style.color = "";
                }, 2000);

            } catch (error) {
                console.error(error.message);

                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand("copy");
                document.body.removeChild(textArea);
            }
        }

        // Update API status indicator with connection state and last update date.
        async function updateApiStatus() {
            let isOnline = false;
            let updatedAt = "unknown";

            try {
                const response = await fetch("./api/v1/meta.json");
                const metadata = await response.json();

                isOnline = true;
                updatedAt = new Date(metadata.generated_at).toLocaleDateString("en-US");
            } catch (error) {
                console.error(error.message);
                isOnline = false;
                updatedAt = "unknown";
            }

            // Create status dot indicator.
            const pointContainer = document.createElement("span");
            pointContainer.className = "relative";

            const staticDot = document.createElement("span");
            staticDot.className = "w-2 h-2 block rounded-full";

            if (isOnline) {
                staticDot.classList.add("bg-green-500");
            } else {
                staticDot.classList.add("bg-red-500");
            }

            pointContainer.appendChild(staticDot);

            // Create animated ping effect for status dot.
            const pingDot = document.createElement("span");
            pingDot.className = "w-2 h-2 absolute top-0 left-0 rounded-full animate-ping";

            if (isOnline) {
                pingDot.classList.add("bg-green-500");
            } else {
                pingDot.classList.add("bg-red-500");
            }

            pointContainer.appendChild(pingDot);

            apiStatus.appendChild(pointContainer);

            // Display status text (ONLINE/OFFLINE).
            const statusText = document.createElement("span");
            statusText.className = "px-2 py-1 rounded";

            if (isOnline) {
                statusText.textContent = "ONLINE";
                statusText.classList.add("text-green-800", "bg-green-100");
            } else {
                statusText.textContent = "OFFLINE";
                statusText.classList.add("text-red-800", "bg-red-100");
            }

            apiStatus.appendChild(statusText);

            // Display last update date.
            const dashText = document.createTextNode("- Last update: ");

            apiStatus.appendChild(dashText);

            const dateText = document.createElement("span");
            dateText.textContent = updatedAt;

            apiStatus.appendChild(dateText);
        }

        // Load available parts from API metadata.
        async function loadParts() {
            try {
                const response = await fetch("./api/v1/meta.json");
                const metadata = await response.json();

                for (const partNumber in metadata.parts) {
                    const option = document.createElement("option");
                    option.value = partNumber;
                    option.textContent = "Part " + partNumber;
                    partSelect.appendChild(option);
                }

                partSelect.disabled = false;
            } catch (error) {
                console.error(error.message);
            }
        }

        // Load cards for selected part.
        async function loadCards(partNumber) {
            try {
                const response = await fetch("./api/v1/parts/" + partNumber + ".json");
                allCardData = await response.json();

                cardSelect.innerHTML = '<option value="">Choose a card</option>';

                for (const cardData of allCardData) {
                    const option = document.createElement("option");
                    option.value = cardData.id;
                    option.textContent = cardData.number + " - " + cardData.title_jp;
                    cardSelect.appendChild(option);
                }

                cardSelect.disabled = false;
            } catch (error) {
                console.error(error.message);
            }
        }

        // Fetch single card data by ID.
        async function loadSingleCard(cardId) {
            try {
                const response = await fetch("./api/v1/cards/" + cardId + ".json");

                return await response.json();
            } catch (error) {
                console.error(error.message);
            }
        }

        // Display selected card details.
        async function displayCardDetails(selectedCard) {
            const cardData = await loadSingleCard(selectedCard);

            cardDetails.innerHTML = "";

            const cardInfoList = document.createElement("ul");

            const cardInfo = [
                '<span class="font-semibold">Part:</span> ' + cardData.part,
                '<span class="font-semibold">Number:</span> ' + cardData.number,
                '<span class="font-semibold">Year:</span> ' + cardData.year,
                '<span class="font-semibold">Rarity:</span> ' + cardData.rarity,
                '<img class="inline" src="https://flagsapi.com/JP/flat/16.png"> ' + cardData.title_jp,
                '<img class="inline" src="https://flagsapi.com/US/flat/16.png"> ' + cardData.title_en,
                '<img class="inline" src="https://flagsapi.com/FR/flat/16.png"> ' + cardData.title_fr
            ];

            cardInfo.forEach(info => {
                const li = document.createElement("li");
                li.innerHTML = info;
                cardInfoList.appendChild(li);
            });

            cardDetails.appendChild(cardInfoList);

            const cardContainer = document.createElement("div");
            cardContainer.className = "w-59 h-86 mx-auto cursor-pointer";
            cardContainer.style.perspective = "1000px";

            const cardFlipper = document.createElement("div");
            cardFlipper.className = "w-full h-full relative transition-transform duration-700";
            cardFlipper.style.transformOrigin = "center";
            cardFlipper.style.transformStyle = "preserve-3d";

            // Front side.
            const frontSide = document.createElement("div");
            frontSide.className = "w-full h-full absolute inset-0";
            frontSide.style.backfaceVisibility = "hidden";

            const frontImg = document.createElement("img");
            frontImg.className = "w-full h-full object-cover rounded-lg";
            frontImg.src = cardData.front_image_url;
            frontImg.alt = "Card front";
            frontSide.appendChild(frontImg);

            // Back side.
            const backSide = document.createElement("div");
            backSide.className = "w-full h-full absolute inset-0";
            backSide.style.backfaceVisibility = "hidden";
            backSide.style.transform = "rotateY(-180deg)";

            const backImg = document.createElement("img");
            backImg.className = "w-full h-full object-cover rounded-lg";
            backImg.src = cardData.back_image_url;
            backImg.alt = "Card back";
            backSide.appendChild(backImg);

            cardFlipper.appendChild(frontSide);
            cardFlipper.appendChild(backSide);
            cardContainer.appendChild(cardFlipper);

            let isFlipped = false;

            cardContainer.addEventListener("click", () => {
                if (isFlipped) {
                    cardFlipper.style.transform = "rotateY(0deg)";
                } else {
                    cardFlipper.style.transform = "rotateY(180deg)";
                }

                isFlipped = !isFlipped;
            });

            cardDetails.appendChild(cardContainer);
        }

        // Handle part selection changes.
        partSelect.addEventListener("change", () => {
            if (partSelect.value) {
                loadCards(partSelect.value);
                cardDetails.innerHTML = "<p>No card selected.</p>";
            } else {
                cardSelect.innerHTML = '<option value="">First, select a part</option>';
                cardSelect.disabled = true;
                cardDetails.innerHTML = "<p>No part selected.</p>";
            }
        });

        // Handle card selection changes.
        cardSelect.addEventListener("change", () => {
            if (cardSelect.value) {
                displayCardDetails(cardSelect.value);
            } else {
                cardDetails.innerHTML = "<p>No card selected.</p>";
            }
        });

        // Initialize the application.
        updateApiStatus()
        loadParts();
    </script>
</body>

</html>